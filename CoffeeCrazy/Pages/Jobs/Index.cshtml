@page
@using CoffeeCrazy.Models
@using CoffeeCrazy.Models.Enums
@model CoffeeCrazy.Pages.Jobs.IndexModel
@{

}
<table class="table">
    <thead>
        <tr>
            <th>Maskine ID</th>
            <th>Opgave Titel</th>
            <th>Beskrivelse</th>
            <th>Kommentar</th>
            <th>Oprettet dato</th>
            <th>Deadline</th>
            <th>Hyppighed</th>
            <th>Medarbejder Navn</th>
            <th>Er Udført?</th>
        </tr>
    </thead>
    <tbody>
        @foreach (Job currentJob in Model.Jobs)
        {
            JobTemplate jobTemplate = Model.JobTemplates.FirstOrDefault(jobTemplateParameter => jobTemplateParameter.JobTemplateId == currentJob.JobTemplateId);
            Frequency frequency = Model.frequencies.FirstOrDefault(frequencyParameter => (int)frequencyParameter == currentJob.FrequencyId);
            User user = Model.Users.FirstOrDefault(userParameter => userParameter.UserId == currentJob.UserId);

            if (jobTemplate != null && frequency != null)
            {
                string rowClass = currentJob.Deadline < DateTime.Now && !currentJob.IsCompleted ? "table-danger" :
                currentJob.IsCompleted ? "table-success" : "table-light";

                <tr class="@rowClass">
                    <td>@currentJob.MachineId</td>

                    <td>@jobTemplate.Title</td>

                    <td>@jobTemplate.Description</td>

                    @if (currentJob.Comment != null)
                    {
                        <td>@currentJob.Comment</td>
                    }
                    else
                    {
                        <td>Ingen kommentar</td>
                    }

                    <td>@currentJob.CreatedDate</td>

                    <td>@currentJob.Deadline</td>

                    <td>@frequency</td>

                    @if (currentJob.UserId != null)
                    {
                        <td>@user.FirstName @user.LastName</td>
                    }
                    else if (currentJob.UserId == null && currentJob.Deadline > DateTime.Now)
                    {
                        <td class="text-warning">Venter på at blive udført</td>
                    }
                    else
                    {
                    <td class="text-danger">Ikke udført af nogen</td>
                    }
                    <td>@currentJob.IsCompleted</td>
                </tr>
            }
        }
    </tbody>

</table>
